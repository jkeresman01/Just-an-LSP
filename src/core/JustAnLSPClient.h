#pragma once

#include <memory>
#include <string>
#include <unordered_map>

#include "../capabilities/ClientCapabilites.h"
#include "../types/ClientInfo.h"

namespace justanlsp
{

//////////////////////////////////////////////////////////////
///
/// @class JustAnLSPClient
///
/// @brief Represent the client that connects to JustAnLSP server
///
//////////////////////////////////////////////////////////////
class JustAnLSPClient
{
  public:
    //////////////////////////////////////////////////////////////
    ///
    /// @brief Default constructor
    ///
    //////////////////////////////////////////////////////////////
    JustAnLSPClient() = default;

    //////////////////////////////////////////////////////////////
    ///
    /// @brief Constructor that saves client info and registers
    ///        clients capabilities
    ///
    /// @param clientInfo
    /// @param clientCapabilites
    ///
    //////////////////////////////////////////////////////////////
    JustAnLSPClient(const ClientInfo &clientInfo,
                    const std::shared_ptr<ClientCapabilities> &clientCapabilites);

    //////////////////////////////////////////////////////////////
    ///
    /// @brief Registers client capabilities (features supported
    ///        by the editor or tool)
    ///
    /// @param clientCapabilites
    ///
    //////////////////////////////////////////////////////////////
    void registerCapabilites(const std::shared_ptr<ClientCapabilities> &clientCapabilites);

    //////////////////////////////////////////////////////////////
    ///
    /// @brief Saves info about the client (name and version)
    ///
    /// @param clientInfo
    ///
    //////////////////////////////////////////////////////////////
    void saveInfo(const ClientInfo &clientInfo);

    //////////////////////////////////////////////////////////////
    ///
    /// @brief Adds new document to keep track of
    ///
    /// @param URI
    /// @param document
    ///
    //////////////////////////////////////////////////////////////
    void addDocument(const std::string &URI, const std::string &document);

    //////////////////////////////////////////////////////////////
    ///
    /// @brief Adds new document to keep track of
    ///
    /// @param URI
    /// @param document
    ///
    //////////////////////////////////////////////////////////////
    void updateDocumentByURI(const std::string &URI, const std::string &document);

    //////////////////////////////////////////////////////////////
    ///
    /// @brief Gets document by provided URI
    ///
    /// @param URI
    ///
    //////////////////////////////////////////////////////////////
    std::string getDocumentByURI(const std::string &URI) const;

    //////////////////////////////////////////////////////////////
    ///
    /// @brief Gets string represenation of client information
    ///
    /// @return clientInfo
    ///
    //////////////////////////////////////////////////////////////
    std::string getInfo() const { return m_clientInfo.toString(); };

  private:
    //////////////////////////////////////////////////////////////
    ///
    /// @brief Client capabilites
    ///
    //////////////////////////////////////////////////////////////
    std::shared_ptr<ClientCapabilities> m_clientCapabilities = std::make_shared<ClientCapabilities>();

    //////////////////////////////////////////////////////////////
    ///
    /// @brief Client information (name and version)
    ///
    //////////////////////////////////////////////////////////////
    ClientInfo m_clientInfo;

    //////////////////////////////////////////////////////////////
    ///
    /// @brief Documents mapped by their corresponding URI
    ///
    //////////////////////////////////////////////////////////////
    std::unordered_map<std::string, std::string> m_documentsByURI;
};
} // namespace justanlsp
